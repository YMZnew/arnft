!function(){"use strict";var e=function(e,t,a){this.width=e,this.height=t,this.root=new THREE.Object3D,this.root.matrixAutoUpdate=!1,this.markerNFTwidth=0,this.markerNFTheigth=0,this.markerNFTdpi=0,this.obj={},this.config=a};e.prototype.init=function(e,n){this.cameraPara;var i=this.root,o=async function(e,t){return await new Promise((function(t,a){const n=new XMLHttpRequest;n.open("GET",e),n.responseType="json",n.onload=function(){t(n.response)},n.onerror=function(){a("error "+n.status)},n.send(null)}))}(this.config),r={};return o.then((function(o){!function(e){var t=document.createElement("div");t.id="loading";var a=document.createElement("img");a.src=e.loading.logo.src,a.alt=e.loading.logo.alt;var n=document.createElement("span");n.setAttribute("class","loading-text"),n.innerText=e.loading.loadingMessage,t.appendChild(a),t.appendChild(n);document.getElementById("marker");document.body.insertBefore(t,document.body.firstChild)}(o),function(e){if(e){var t=document.createElement("div");t.id="stats",t.className="ui stats";var a=document.createElement("div");a.id="stats1",a.className="stats-item";var n=document.createElement("p");n.className="stats-item-title",n.innerText="Main",a.appendChild(n),t.appendChild(a);var i=document.createElement("div");i.id="stats2",i.className="stats-item";var o=document.createElement("p");o.className="stats-item-title",o.innerText="Worker",i.appendChild(o),t.appendChild(i);var r=document.getElementById("loading");document.body.insertBefore(t,r)}}(n);var d=function(){var e=document.createElement("div");e.id="app";var t=document.createElement("canvas");t.id="canvas";var a=document.createElement("video");a.id="video",a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.setAttribute("playsinline",""),e.appendChild(a),e.appendChild(t);var n=document.getElementById("loading");return document.body.insertBefore(e,n),{container:e,canvas:t,video:a}}(),s=(d.container,d.canvas),c=d.video;if(n){var l=new Stats;l.showPanel(0),document.getElementById("stats1").appendChild(l.dom);var m=new Stats;m.showPanel(0),document.getElementById("stats2").appendChild(m.dom)}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var u={audio:!1,video:!0};window.innerWidth<800&&(u={audio:!1,video:{width:{ideal:this.width},height:{ideal:this.height},facingMode:{exact:"environment"}}}),navigator.mediaDevices.getUserMedia(u).then((function(d){c.srcObject=d,c.addEventListener("loadedmetadata",(function(){c.play(),r=function(e,n,i,o,r,d,s,c,l,m){var u,p,v,h,g,f,E,w,y,x,b,T,R,k=document.createElement("canvas"),A=k.getContext("2d"),C=new THREE.WebGLRenderer({canvas:d,alpha:m.renderer.alpha,antialias:m.renderer.antialias,precision:m.renderer.precision});C.setPixelRatio(window.devicePixelRatio);var M=new THREE.Scene,H=new THREE.Camera;H.matrixAutoUpdate=!1,M.add(H);var j=new THREE.AmbientLight(16777215);M.add(j);var N=new THREE.Object3D;N.matrixAutoUpdate=!1,M.add(l);var P,U=function(){u=o,p=r,g=320/Math.max(u,p/3*4),f=/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?window.outerWidth/o:1,v=u*f,h=p*f,E=u*g,w=p*g,y=Math.max(E,w/3*4),x=Math.max(w,E/4*3),b=(y-E)/2,T=(x-w)/2,k.style.clientWidth=y+"px",k.style.clientHeight=x+"px",k.width=y,k.height=x,C.setSize(v,h),(R=new Worker(m.workerUrl)).postMessage({type:"load",pw:y,ph:x,camera_para:m.cameraPara,marker:n,artoolkitUrl:m.artoolkitUrl}),R.onmessage=function(e){var t=e.data;switch(t.type){case"loaded":var n=JSON.parse(t.proj),i=y/E,o=x/w;n[0]*=i,n[4]*=i,n[8]*=i,n[12]*=i,n[1]*=o,n[5]*=o,n[9]*=o,n[13]*=o,a(H.projectionMatrix,n);break;case"endLoading":if(1==t.end){var r=document.getElementById("loading");r&&(r.querySelector(".loading-text").innerText="Start the tracking!",setTimeout((function(){r.parentElement.removeChild(r)}),2e3))}break;case"found":B(t);break;case"not found":B(null)}c(),S()}},B=function(e){e?(P=JSON.parse(e.matrixGL_RH),N.position.y=e.height/e.dpi*2.54*10/2,N.position.x=e.width/e.dpi*2.54*10/2):P=null},I=Date.now();function S(){A.fillStyle="black",A.fillRect(0,0,y,x),A.drawImage(i,0,0,u,p,b,T,E,w);var e=A.getImageData(0,0,y,x);R.postMessage({type:"process",imagedata:e},[e.data.buffer])}var D=function(){L(),requestAnimationFrame(D)},L=function(){s();var e=Date.now();if(e-I,I=e,P){l.visible=!0;for(var n=0;n<16;n++)t.delta[n]=P[n]-t.interpolated[n],t.interpolated[n]=t.interpolated[n]+t.delta[n]/24;a(l.matrix,t.interpolated)}else l.visible=!1;C.render(M,H)};return U(),D(),S(),N}(0,e,c,c.videoWidth,c.videoHeight,s,(function(){n&&l.update()}),(function(){n&&m.update()}),i,o),console.log(void 0),this.obj=void 0,console.log(this.obj)}))})).catch((function(e){console.log(e.name+": "+e.message)}))}})),r},e.prototype.add=function(e){var t=this.root;console.log("obj inside add",void 0),t.matrixAutoUpdate=!1,t.add(void 0)},e.prototype.loadModel=function(e,t,a,n,i){var o,r=this.root;(new THREE.GLTFLoader).load(e,(function(e){(o=e.scene).scale.set(i,i,i),o.rotation.x=Math.PI/2,o.position.x=t,o.position.y=a,o.position.z=n,o.matrixAutoUpdate=!1,r.add(o)}))};var t={delta:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],interpolated:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=function(e,t){var a=[];for(var n in t)a[n]=t[n];"function"==typeof e.elements.set?e.elements.set(a):e.elements=[].slice.call(a)};window.ARnft=e,window.THREE=THREE}();