!function(){"use strict";let e;var t=function(e,t,a){this.width=e,this.height=t,this.root=new THREE.Object3D,this.root.matrixAutoUpdate=!1,this.listeners={},this.markerNFTwidth=0,this.markerNFTheigth=0,this.markerNFTdpi=0,this.obj={},this.config=a};t.prototype.init=function(t,i){this.cameraPara;var o=this.root;return async function(e,t){return await new Promise((function(t,a){const n=new XMLHttpRequest;n.open("GET",e),n.responseType="json",n.onload=function(){t(n.response)},n.onerror=function(){a("error "+n.status)},n.send(null)}))}(this.config).then((function(r){!function(e){var t=document.createElement("div");t.id="loading";var a=document.createElement("img");a.src=e.loading.logo.src,a.alt=e.loading.logo.alt;var n=document.createElement("span");n.setAttribute("class","loading-text"),n.innerText=e.loading.loadingMessage,t.appendChild(a),t.appendChild(n);document.getElementById("marker");document.body.insertBefore(t,document.body.firstChild)}(r),function(e){if(e){var t=document.createElement("div");t.id="stats",t.className="ui stats";var a=document.createElement("div");a.id="stats1",a.className="stats-item";var n=document.createElement("p");n.className="stats-item-title",n.innerText="Main",a.appendChild(n),t.appendChild(a);var i=document.createElement("div");i.id="stats2",i.className="stats-item";var o=document.createElement("p");o.className="stats-item-title",o.innerText="Worker",i.appendChild(o),t.appendChild(i);var r=document.getElementById("loading");document.body.insertBefore(t,r)}}(i);var d=function(){var e=document.createElement("div");e.id="app";var t=document.createElement("canvas");t.id="canvas";var a=document.createElement("video");a.id="video",a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.setAttribute("playsinline",""),e.appendChild(a),e.appendChild(t);var n=document.getElementById("loading");return document.body.insertBefore(e,n),{container:e,canvas:t,video:a}}(),s=(d.container,d.canvas),l=d.video;if(i){var c=new Stats;c.showPanel(0),document.getElementById("stats1").appendChild(c.dom);var m=new Stats;m.showPanel(0),document.getElementById("stats2").appendChild(m.dom)}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var u={audio:!1,video:!0};window.innerWidth<800&&(u={audio:!1,video:{width:{ideal:this.width},height:{ideal:this.height},facingMode:{exact:"environment"}}}),navigator.mediaDevices.getUserMedia(u).then((function(d){l.srcObject=d,l.addEventListener("loadedmetadata",(function(){l.play(),e=function(e,t,i,o,r,d,s,l,c,m){var u,p,h,v,f,g,E,w,y,x,b,T,R,k=document.createElement("canvas"),A=k.getContext("2d"),C=new THREE.WebGLRenderer({canvas:d,alpha:m.renderer.alpha,antialias:m.renderer.antialias,precision:m.renderer.precision});C.setPixelRatio(window.devicePixelRatio);var M=new THREE.Scene,H=new THREE.Camera;H.matrixAutoUpdate=!1,M.add(H);var j=new THREE.AmbientLight(16777215);M.add(j);var N=new THREE.Object3D;N.matrixAutoUpdate=!1,M.add(c);var P,U=function(){u=o,p=r,f=320/Math.max(u,p/3*4),g=/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?window.outerWidth/o:1,h=u*g,v=p*g,E=u*f,w=p*f,y=Math.max(E,w/3*4),x=Math.max(w,E/4*3),b=(y-E)/2,T=(x-w)/2,k.style.clientWidth=y+"px",k.style.clientHeight=x+"px",k.width=y,k.height=x,C.setSize(h,v),(R=new Worker(m.workerUrl)).postMessage({type:"load",pw:y,ph:x,camera_para:m.cameraPara,marker:t,artoolkitUrl:m.artoolkitUrl}),R.onmessage=function(e){var t=e.data;switch(t.type){case"loaded":var a=JSON.parse(t.proj),i=y/E,o=x/w;a[0]*=i,a[4]*=i,a[8]*=i,a[12]*=i,a[1]*=o,a[5]*=o,a[9]*=o,a[13]*=o,n(H.projectionMatrix,a);break;case"endLoading":if(1==t.end){var r=document.getElementById("loading");r&&(r.querySelector(".loading-text").innerText="Start the tracking!",setTimeout((function(){r.parentElement.removeChild(r)}),2e3))}break;case"found":B(t);break;case"not found":B(null)}l(),L()}},B=function(e){e?(P=JSON.parse(e.matrixGL_RH),N.position.y=e.height/e.dpi*2.54*10/2,N.position.x=e.width/e.dpi*2.54*10/2):P=null},I=Date.now();function L(){A.fillStyle="black",A.fillRect(0,0,y,x),A.drawImage(i,0,0,u,p,b,T,E,w);var e=A.getImageData(0,0,y,x);R.postMessage({type:"process",imagedata:e},[e.data.buffer])}var S=function(){D(),requestAnimationFrame(S)},D=function(){s();var e=Date.now();if(e-I,I=e,P){c.visible=!0;for(var t=0;t<16;t++)a.delta[t]=P[t]-a.interpolated[t],a.interpolated[t]=a.interpolated[t]+a.delta[t]/24;n(c.matrix,a.interpolated)}else c.visible=!1;C.render(M,H)};return U(),S(),L(),N}(0,t,l,l.videoWidth,l.videoHeight,s,(function(){i&&c.update()}),(function(){i&&m.update()}),o,r),console.log(e),this.obj=e,console.log(this.obj)}))})).catch((function(e){console.log(e.name+": "+e.message)}))}})),{}},t.prototype.add=function(e){var t=this.root;console.log("obj inside add",e),t.matrixAutoUpdate=!1,t.add(e)},t.prototype.addEventListener=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.prototype.dispatchEvent=function(e){var t=this.listeners[e.name];if(t)for(var a=0;a<t.length;a++)t[a].call(this,e)},t.prototype.loadModel=function(e,t,a,n,i){var o,r=this.root;(new THREE.GLTFLoader).load(e,(function(e){(o=e.scene).scale.set(i,i,i),o.rotation.x=Math.PI/2,o.position.x=t,o.position.y=a,o.position.z=n,o.matrixAutoUpdate=!1,r.add(o)}))};var a={delta:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],interpolated:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},n=function(e,t){var a=[];for(var n in t)a[n]=t[n];"function"==typeof e.elements.set?e.elements.set(a):e.elements=[].slice.call(a)};window.ARnft=t,window.THREE=THREE}();