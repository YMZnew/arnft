! function() {
"use strict";
let e;
var t = function(e, t, a) {
this.width = e, this.height = t, this.root = new THREE.Object3D, this.root.matrixAutoUpdate = !1, this.listeners = {}, this.markerNFTwidth = 0, this.markerNFTheigth = 0, this.markerNFTdpi = 0, this.obj = {}, this.config = a
};
t.prototype.init = function(t, i) {
this.cameraPara;
var r = this.root;
return async function(e, t) {
return await new Promise((function(t, a) {
const n = new XMLHttpRequest;
n.open("GET", e), n.responseType = "json", n.onload = function() {
t(n.response)
}, n.onerror = function() {
a("error " + n.status)
}, n.send(null)
}))
}(this.config).then((function(o) {
! function(e) {
var t = document.createElement("div");
t.id = "loading";
var a = document.createElement("img");
a.src = e.loading.logo.src, a.alt = e.loading.logo.alt;
var n = document.createElement("span");
n.setAttribute("class", "loading-text"), n.innerText = e.loading.loadingMessage, t.appendChild(a), t.appendChild(n);
document.getElementById("marker");
document.body.insertBefore(t, document.body.firstChild)
}(o),
function(e) {
if(e) {
var t = document.createElement("div");
t.id = "stats", t.className = "ui stats";
var a = document.createElement("div");
a.id = "stats1", a.className = "stats-item";
var n = document.createElement("p");
n.className = "stats-item-title", n.innerText = "Main", a.appendChild(n), t.appendChild(a);
var i = document.createElement("div");
i.id = "stats2", i.className = "stats-item";
var r = document.createElement("p");
r.className = "stats-item-title", r.innerText = "Worker", i.appendChild(r), t.appendChild(i);
var o = document.getElementById("loading");
document.body.insertBefore(t, o)
}
}(i);
var d = function() {
var e = document.createElement("div");
e.id = "app";
var t = document.createElement("canvas");
t.id = "canvas";
var a = document.createElement("video");
a.id = "video", a.setAttribute("autoplay", ""), a.setAttribute("muted", ""), a.setAttribute("playsinline", ""), e.appendChild(a), e.appendChild(t);
var n = document.getElementById("loading");
return document.body.insertBefore(e, n), {
container: e,
canvas: t,
video: a
}
}(),
s = (d.container, d.canvas),
l = d.video;
if(i) {
var c = new Stats;
c.showPanel(0), document.getElementById("stats1").appendChild(c.dom);
var m = new Stats;
m.showPanel(0), document.getElementById("stats2").appendChild(m.dom)
}
if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
var p = {
audio: !1,
video: !0
};
window.innerWidth < 800 && (p = {
audio: !1,
video: {
width: {
ideal: this.width
},
height: {
ideal: this.height
},
facingMode: {
exact: "environment"
}
}
}), navigator.mediaDevices.getUserMedia(p).then((function(d) {
l.srcObject = d, l.addEventListener("loadedmetadata", (function() {
l.play(), e = function(e, t, i, r, o, d, s, l, c, m) {
var p, u, h, v, g, f, w, y, E, k, b, x, T, N = document.createElement("canvas"),
M = N.getContext("2d"),
R = new THREE.WebGLRenderer({
canvas: d,
alpha: m.renderer.alpha,
antialias: m.renderer.antialias,
precision: m.renderer.precision
});
R.setPixelRatio(window.devicePixelRatio);
var S = new THREE.Scene,
C = new THREE.Camera;
C.matrixAutoUpdate = !1, S.add(C);
var A = new THREE.AmbientLight(16777215);
S.add(A), (new THREE.Object3D).matrixAutoUpdate = !1, S.add(c);
var L;

function H() {
self.onmessage = function(n) {
var i = n.data;
switch (i.type) {
case "load":
return void
function(e) {
var n = self.origin;
console.log("base path:", n);
var i = n + "/" + e.artoolkitUrl;
importScripts(i), self.addEventListener("artoolkitNFT-loaded", (function() {
var i = n + "/" + e.camera_para,
r = new ARCameraParamNFT(i);
r.onload = function() {
var i = (t = new ARControllerNFT(e.pw, e.ph, r)).getCameraMatrix();
t.addEventListener("getNFTMarker", (function(e) {
a = {
type: "found",
matrixGL_RH: JSON.stringify(e.data.matrixGL_RH),
width: JSON.stringify(e.data.marker.width),
height: JSON.stringify(e.data.marker.height),
dpi: JSON.stringify(e.data.marker.dpi),
proj: JSON.stringify(i)
}
}));
var o = n + "/" + e.marker;
t.loadNFTMarker(o, (function(e) {
t.trackNFTMarkerId(e.id, 2), console.log("loadNFTMarker -> ", e.id), postMessage({
type: "markerData",
markerData: JSON.stringify(e)
}), postMessage({
type: "endLoading",
end: !0
})
})), postMessage({
type: "loaded",
proj: JSON.stringify(i)
})
}
}))
}(i);
case "process":
return e = i.imagedata, void
function() {
a = null, t && t.process(e);
a ? postMessage(a) : postMessage({
type: "not found"
});
e = null
}()
}
};
var e = null,
t = null,
a = null
}
var j = function(e) {
L = e ? JSON.parse(e.matrixGL_RH) : null
},
O = Date.now();

function D() {
M.fillStyle = "black", M.fillRect(0, 0, E, k), M.drawImage(i, 0, 0, p, u, b, x, w, y);
var e = M.getImageData(0, 0, E, k);
T.postMessage({
type: "process",
imagedata: e
}, [e.data.buffer])
}
var F = function() {
U(), requestAnimationFrame(F)
},
U = function() {
s();
var e = Date.now();
if(e - O, O = e, L) {
c.visible = !0;
for(var t = 0; t < 16; t++) a.delta[t] = L[t] - a.interpolated[t], a.interpolated[t] = a.interpolated[t] + a.delta[t] / 24;
n(c.matrix, a.interpolated)
} else c.visible = !1;
R.render(S, C)
};
(function() {
p = r, u = o, g = 320 / Math.max(p, u / 3 * 4), f = /Android|mobile|iPad|iPhone/i.test(navigator.userAgent) ? window.outerWidth / r : 1, h = p * f, v = u * f, w = p * g, y = u * g, E = Math.max(w, y / 3 * 4), k = Math.max(y, w / 4 * 3), b = (E - w) / 2, x = (k - y) / 2, N.style.clientWidth = E + "px", N.style.clientHeight = k + "px", N.width = E, N.height = k, R.setSize(h, v);
var e = new Blob([H.toString().replace(/^function .+\{?|\}$/g, "")], {
type: "text/js-worker"
}),
a = URL.createObjectURL(e);
(T = new Worker(a)).postMessage({
type: "load",
pw: E,
ph: k,
camera_para: m.cameraPara,
marker: t,
artoolkitUrl: m.artoolkitUrl
}), T.onmessage = function(e) {
var t = e.data;
switch (t.type) {
case "loaded":
var a = JSON.parse(t.proj),
i = E / w,
r = k / y;
a[0] *= i, a[4] *= i, a[8] *= i, a[12] *= i, a[1] *= r, a[5] *= r, a[9] *= r, a[13] *= r, n(C.projectionMatrix, a);
break;
case "endLoading":
if(1 == t.end) {
var o = document.getElementById("loading");
o && (o.querySelector(".loading-text").innerText = "Start the tracking!", setTimeout((function() {
o.parentElement.removeChild(o)
}), 2e3))
}
break;
case "markerData":
if(e.data.markerData) {
var d = JSON.parse(e.data.markerData);
console.log(d)
}
break;
case "found":
j(t);
break;
case "not found":
j(null)
}
l(), D()
}
})(), F(), D()
}(0, t, l, l.videoWidth, l.videoHeight, s, (function() {
i && c.update()
}), (function() {
i && m.update()
}), r, o), console.log(e), this.obj = e, console.log(this.obj)
}))
})).catch((function(e) {
console.log(e.name + ": " + e.message)
}))
}
})), {}
}, t.prototype.add = function(e) {
var t = this.root;
console.log("obj inside add", e), t.matrixAutoUpdate = !1, t.add(e)
}, t.prototype.addEventListener = function(e, t) {
this.listeners[e] || (this.listeners[e] = []), this.listeners[e].push(t)
}, t.prototype.dispatchEvent = function(e) {
var t = this.listeners[e.name];
if(t)
for(var a = 0; a < t.length; a++) t[a].call(this, e)
}, t.prototype.loadModel = function(e, t, a, n, i) {
var r, o = this.root;
(new THREE.GLTFLoader).load(e, (function(e) {
(r = e.scene).scale.set(i, i, i), r.rotation.x = Math.PI / 2, r.position.x = t, r.position.y = a, r.position.z = n, r.matrixAutoUpdate = !1, o.add(r)
}))
};
var a = {
delta: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
interpolated: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
},
n = function(e, t) {
var a = [];
for(var n in t) a[n] = t[n];
"function" == typeof e.elements.set ? e.elements.set(a) : e.elements = [].slice.call(a)
};
window.ARnft = t, window.THREE = THREE
}();
